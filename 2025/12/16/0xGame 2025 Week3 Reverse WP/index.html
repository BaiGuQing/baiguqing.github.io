<!DOCTYPE html>
<html lang="zh-cn">
  <head prefix="og: https://ogp.me/ns#">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="color-scheme" content="light dark">
  
  <title>0xGame 2025 Week3 Reverse WP - GuQing&#39;s Blog</title>
  
    <link rel="shortcut icon" href="/favicon.jpg">
  
  
  <link rel='manifest' href='/manifest.json'>
  

  <meta name="description" content="引言 我希望能够帮助像我一样的新手，如果大佬发现WP有问题可以评论，我会改进！  ezVBS 我不得不说，要听劝。原题都告诉我了，不让我打开，我还就偏打开了，然后去网上搜VBS逆向，最后在赛博厨子那里逆向出了  1I have already warned you not to run VBS directly, your computer is likely to be attacked bec">
<meta property="og:type" content="article">
<meta property="og:title" content="0xGame 2025 Week3 Reverse WP">
<meta property="og:url" content="http://example.com/2025/12/16/0xGame%202025%20Week3%20Reverse%20WP/index.html">
<meta property="og:site_name" content="GuQing&#39;s Blog">
<meta property="og:description" content="引言 我希望能够帮助像我一样的新手，如果大佬发现WP有问题可以评论，我会改进！  ezVBS 我不得不说，要听劝。原题都告诉我了，不让我打开，我还就偏打开了，然后去网上搜VBS逆向，最后在赛博厨子那里逆向出了  1I have already warned you not to run VBS directly, your computer is likely to be attacked bec">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/Images/20251123174856.png">
<meta property="og:image" content="http://example.com/Images/20251123175110.png">
<meta property="og:image" content="http://example.com/Images/20251123175411.png">
<meta property="og:image" content="http://example.com/Images/20251123175737.png">
<meta property="og:image" content="http://example.com/Images/20251123175846.png">
<meta property="og:image" content="http://example.com/Images/20251127214115.png">
<meta property="og:image" content="http://example.com/Images/20251127135638.png">
<meta property="og:image" content="http://example.com/Images/20251127141800.png">
<meta property="og:image" content="http://example.com/Images/20251127141947.png">
<meta property="og:image" content="http://example.com/Images/20251127142147.png">
<meta property="og:image" content="http://example.com/Images/20251127142521.png">
<meta property="og:image" content="http://example.com/Images/20251127142743.png">
<meta property="og:image" content="http://example.com/Images/20251127143005.png">
<meta property="og:image" content="http://example.com/Images/20251127143106.png">
<meta property="og:image" content="http://example.com/Images/20251127143353.png">
<meta property="og:image" content="http://example.com/Images/20251127165632.png">
<meta property="og:image" content="http://example.com/Images/20251127165657.png">
<meta property="og:image" content="http://example.com/Images/20251127171318.png">
<meta property="og:image" content="http://example.com/Images/20251127170835.png">
<meta property="og:image" content="http://example.com/Images/20251127170936.png">
<meta property="og:image" content="http://example.com/Images/20251127171403.png">
<meta property="og:image" content="http://example.com/Images/20251127171410.png">
<meta property="og:image" content="http://example.com/Images/20251127171545.png">
<meta property="og:image" content="http://example.com/Images/20251127171712.png">
<meta property="og:image" content="http://example.com/Images/20251127172417.png">
<meta property="og:image" content="http://example.com/Images/20251129114046.png">
<meta property="og:image" content="http://example.com/Images/20251205211719.png">
<meta property="og:image" content="http://example.com/Images/20251205212119.png">
<meta property="og:image" content="http://example.com/Images/20251205211831.png">
<meta property="og:image" content="http://example.com/Images/20251205212158.png">
<meta property="og:image" content="http://example.com/Images/20251205212345.png">
<meta property="og:image" content="http://example.com/Images/20251205212402.png">
<meta property="og:image" content="http://example.com/Images/20251205212612.png">
<meta property="og:image" content="http://example.com/Images/20251205212735.png">
<meta property="og:image" content="http://example.com/Images/20251205212808.png">
<meta property="og:image" content="http://example.com/Images/20251205213242.png">
<meta property="og:image" content="http://example.com/Images/20251205213451.png">
<meta property="og:image" content="http://example.com/Images/20251205214825.png">
<meta property="og:image" content="http://example.com/Images/20251205215713.png">
<meta property="og:image" content="http://example.com/Images/20251205221141.png">
<meta property="og:image" content="http://example.com/Images/202512181958.png">
<meta property="og:image" content="http://example.com/Images/202512182000.png">
<meta property="og:image" content="http://example.com/Images/202512182001.png">
<meta property="og:image" content="http://example.com/Images/202512182005.png">
<meta property="article:published_time" content="2025-12-15T16:00:00.000Z">
<meta property="article:modified_time" content="2025-12-19T15:02:14.363Z">
<meta property="article:author" content="GuQing">
<meta property="article:tag" content="Reverse_Writeup">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/Images/20251123174856.png">

  <link rel="preconnect" href="https://rsms.me/">
  <link rel="stylesheet" href="https://rsms.me/inter/inter.css">
  
  
<link rel="stylesheet" href="https://unpkg.com/simple-icons-font@15/font/simple-icons.min.css">

  
  
  
<link rel="stylesheet" href="https://unpkg.com/bootstrap-icons@1/font/bootstrap-icons.min.css">

  

  
<link rel="stylesheet" href="/css/var.css">

  
<link rel="stylesheet" href="/css/main.css">

  
<link rel="stylesheet" href="/css/typography.css">

  
<link rel="stylesheet" href="/css/code-highlighting.css">

  
  
  
<link rel="stylesheet" href="/css/components/card.css">

  
  
  
  
<link rel="stylesheet" href="/css/components/button.css">

  
  
  
  
<link rel="stylesheet" href="/css/components/badge.css">

  
  
  
  
<link rel="stylesheet" href="/css/components/utilities.css">

  
  
  
  
<link rel="stylesheet" href="/css/components/carousel.css">

  
  
  
<link rel="stylesheet" href="/css/nav.css">

  
<link rel="stylesheet" href="/css/paginator.css">

  
<link rel="stylesheet" href="/css/footer.css">

  
<link rel="stylesheet" href="/css/post-list.css">

  
  
  
<link rel="stylesheet" href="/css/toc.css">

  
  
  
  
  
<link rel="stylesheet" href="/css/post.css">

  
  
  
  
  
  
  
<link rel="stylesheet" href="/css/scroll-reveal.css">

  
  
  
<link rel="stylesheet" href="/css/view-transition.css">

  
  

  

  
<script src="/js/head.js"></script>

  
<meta name="generator" content="Hexo 8.1.1"></head>

  <body
    data-color-scheme="auto"
    data-uppercase-categories="true"
    
    data-config-root="/"
    
    data-toc="true"
    data-toc-max-depth="2"
    
    
    
    data-scroll-reveal-disappear="false"
    data-scroll-reveal-query=".scroll-reveal, .post-list-item, .card, .content p img, .content .block-large img"
    
    data-nav-blur-gradient="false"
    data-corner-squircle="true"
  >
    
<script src="/js/body-top.js"></script>

    <a href="#main-content" id="skip-to-content">跳至主要内容</a>
    

<nav id="theme-nav">
  <div class="inner">
    <a class="title" href="/">GuQing&#39;s Blog</a>
    <div class="nav-arrow"></div>
    <div class="nav-items">
      <a class="nav-item nav-item-home" href="/" style="--index: 0">主页</a>

      
      <a class="nav-item" href="/About-Me" style="--index: 1">关于我</a>
      
      <a class="nav-item" href="/archives" style="--index: 2">归档</a>
      
      <a class="nav-item" href="/tags" style="--index: 3">标签</a>
      
      <a class="nav-item" href="/categories" style="--index: 4">分类</a>
      
      <a class="nav-item is-icon" href="/search" style="--index: 5"><i class="bi bi-search"></i></a>
      
    </div>
  </div>
</nav>

    <main id="main-content" data-pagefind-body>
      
<article class="post">
  
  <div class="meta">
    
    <div class="categories text-uppercase">
    
      <a href="/categories/CTF-WP/">CTF_WP</a>
    
    </div>
    

    
    <time class="date" datetime="2025-12-16T00:00:00+08:00">
      2025-12-16
    </time>
    

    <h1 class="title" data-pagefind-meta="title">0xGame 2025 Week3 Reverse WP</h1>
  </div>

  <div class="content">
    <h1 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h1><ul>
<li>我希望能够帮助像我一样的新手，如果大佬发现WP有问题可以评论，我会改进！</li>
</ul>
<h1 id="ezVBS"><a href="#ezVBS" class="headerlink" title="ezVBS"></a>ezVBS</h1><ul>
<li>我不得不说，要听劝。原题都告诉我了，不让我打开，我还就偏打开了，然后去网上搜VBS逆向，最后在赛博厨子那里逆向出了</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">I have already warned you not to run VBS directly, your computer is likely to be attacked because of this, just as your flag has been overwritten</span><br></pre></td></tr></table></figure>
<ul>
<li>当时没怎么注意文字，就去看官方WP了，结果打开记事本看了看，和WP上的不一样啊，我还以为题出错了，回来又下了一遍，没运行，直接记事本编译，我恍然大悟，给我自己气笑了</li>
<li><img src="/Images/20251123174856.png"></li>
<li>把execute换成wscript.echo，在根目录下运行cmd，输入cscript 1.vbs</li>
<li><img src="/Images/20251123175110.png"></li>
<li>复制回1.vbs</li>
<li>继续替换，直到出现正常的代码</li>
<li><img src="/Images/20251123175411.png"></li>
<li>这里再运行一遍，还需要替换一遍再运行，才能得到</li>
<li><img src="/Images/20251123175737.png"></li>
<li>然后交给赛博厨子</li>
<li><img src="/Images/20251123175846.png"></li>
</ul>
<h1 id="Q-≧▽≦-T"><a href="#Q-≧▽≦-T" class="headerlink" title="Q(≧▽≦)T"></a>Q(≧▽≦)T</h1><ul>
<li>先运行一下exe文件，发现是输入账户密码类型的，我先用exeinfope看了下有没有壳，发现没有，就拖进了dbg，然后搜索了下字符串</li>
<li>中文乱码的话需要安装插件，x64dbg_tol</li>
<li><img src="/Images/20251127214115.png"></li>
<li><img src="/Images/20251127135638.png"></li>
<li>很明显有两个加密后的字符串以及各种提醒文字</li>
<li>如果运行了或者看到这个提醒就知道，用户名是四位数字的，我们输出1234试一试，在这之前先打个断点</li>
<li><img src="/Images/20251127141800.png"></li>
<li>运行后发现这个不是判定用户名是否正确的，而是下面的代码，到达断点后用f7到下面（记得先f9运行一下）</li>
<li><img src="/Images/20251127141947.png"></li>
<li>看到这里应该可以猜出是判断是否相等，看了之前的字符串，就知道03ac674216f3e15c761ee1a5e255f067953623c8b388b4459e13f978d7c846f4是我们输入的1234加密后的字符串</li>
<li>我们去赛博厨子跑一下</li>
<li><img src="/Images/20251127142147.png"></li>
<li>发现是SHA-256，我们就可以找一个在线平台破解一下之前的SHA-256</li>
<li><img src="/Images/20251127142521.png"></li>
<li>就得到了用户名</li>
<li>然后就去找关于密码的字符串继续看相应内容</li>
<li>转到相应的反汇编之后，会发现只有上面的函数和密码加密相关</li>
<li><img src="/Images/20251127142743.png"></li>
<li>然后就可以把exe丢到IDA分析一下了</li>
<li><img src="/Images/20251127143005.png"></li>
<li>最后就会发现是这个函数在进行加密</li>
<li><img src="/Images/20251127143106.png"></li>
<li>联系之前搜索到的字符串，去赛博厨子破解一下</li>
<li><img src="/Images/20251127143353.png"></li>
<li>就得到了flag</li>
<li>这道题我不看官方WP根本没头绪啊:(</li>
</ul>
<h1 id="Minesweeper"><a href="#Minesweeper" class="headerlink" title="Minesweeper"></a>Minesweeper</h1><ul>
<li>打开ms_obfus.js，然后把expert模式下的mines改为0x1，打开hmtl</li>
<li><img src="/Images/20251127165632.png"></li>
<li>剩余地雷为1就成功了，随便点一下</li>
<li><img src="/Images/20251127165657.png"></li>
<li>用chatgpt也可以直接出</li>
<li><img src="/Images/20251127171318.png"></li>
</ul>
<h1 id="easyApp"><a href="#easyApp" class="headerlink" title="easyApp"></a>easyApp</h1><ul>
<li>下个手机模拟器安装一下，就会发现是个输入+校验的程序</li>
<li>可以用jadx进行分析</li>
<li>接下来先看AndroidManifest.xml这个文件，它实际上是⼀个apk的配置文件，里面存储了apk的很多信息，包括程序入口点，我们要分析程序的执行逻辑，就得先找到程序的入口点</li>
<li><img src="/Images/20251127170835.png"></li>
<li>这个就是入口了，双击可以跳转</li>
<li><img src="/Images/20251127170936.png"></li>
<li>onCreat相当于c语言的main函数，就是入口函数</li>
<li>直接把代码丢给chatgpt :）</li>
<li><img src="/Images/20251127171403.png"></li>
<li><img src="/Images/20251127171410.png"></li>
<li><img src="/Images/20251127171545.png"></li>
<li>直接解压apk，会发现目录和这个反编译目录一样</li>
<li>然后把解压出来的bin文件继续拖到jadx</li>
<li><img src="/Images/20251127171712.png"></li>
<li>用一下官方WP的脚本</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *  </span><br><span class="line">a,b,c = Ints(<span class="string">&quot;a b c&quot;</span>)  </span><br><span class="line">s = Solver()  </span><br><span class="line">s.add(a*<span class="number">3</span> + b - <span class="number">27454419028250566601</span> == <span class="number">0</span>)  </span><br><span class="line">s.add(c*<span class="number">2</span> - <span class="number">5</span>*b + <span class="number">20616666104378640363</span> == <span class="number">0</span>)  </span><br><span class="line">s.add(a + <span class="number">4</span>*c - <span class="number">0x1dce62be9f0fa2f6c</span> == <span class="number">0</span>)  </span><br><span class="line"><span class="keyword">if</span> s.check() == sat:  </span><br><span class="line">    result = s.model()  </span><br><span class="line">    <span class="keyword">for</span> var <span class="keyword">in</span> (a,c):  </span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">hex</span>(result[var].as_long())[<span class="number">2</span>:],end=<span class="string">&quot;&quot;</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li><img src="/Images/20251127172417.png"></li>
</ul>
<h1 id="World’s-end-BlackBox"><a href="#World’s-end-BlackBox" class="headerlink" title="World’s_end_BlackBox"></a>World’s_end_BlackBox</h1><ul>
<li>先用exeinfope看看有没有壳，发现没壳，拖进ida发现也看不懂</li>
<li>直接拖进dbg搜索一下字符串</li>
<li><img src="/Images/20251129114046.png"></li>
<li>发现是输入两段字符串</li>
<li>把两段Length Error处上面的代码打上断点</li>
<li>然后双击到第一个length error处</li>
<li>发现他是在对比我们第一个输入的字符串长度，f9运行到这里</li>
<li>按空格将jz改为jmp</li>
<li><img src="/Images/20251205211719.png"></li>
<li>这里其实可以看到应该是长度为12才能过（0xC&#x3D;12）</li>
<li><img src="/Images/20251205212119.png"></li>
<li>往下翻一翻会发现下面有个密码错误，在它上方打个断点</li>
<li><img src="/Images/20251205211831.png"></li>
<li>那很明显这是在对比密码正确与否，这时候按f9就能看到正确密码了</li>
<li>这里也需要改下汇编和上面一致</li>
<li><img src="/Images/20251205212158.png"></li>
<li>这里就显示了正确密码，如果你想要知道这个密码哪里来的</li>
<li>也很简单，看上方的每个函数，应该调用了两个函数，我们会发现第一个函数就是加密函数，采用的是xxtea</li>
<li><img src="/Images/20251205212345.png"></li>
<li><img src="/Images/20251205212402.png"></li>
<li>接着往下走会发现还有个长度错误</li>
<li>接着断点，改汇编，f9</li>
<li><img src="/Images/20251205212612.png"></li>
<li>接着往下看会发现有个all perfect的字样</li>
<li>在它上方打上断点</li>
<li><img src="/Images/20251205212735.png"></li>
<li>你会发现这两个断点之前有很多内容，但是真正重要的只有</li>
<li><img src="/Images/20251205212808.png"></li>
<li>这个函数，以及它上方的存储的东西</li>
<li>这里f9运行到刚打的断点，在这之前现在cmd框里输入点东西，因为之前那一大段内容现在用不到，这一部分是加密的</li>
<li>接下来就是看这个406D80的函数，看上面的汇编应该可以知道是传入了两个参数，一个是读取你的，一个是它自带的</li>
<li><img src="/Images/20251205213242.png"></li>
<li>双击这个40B0A0可以在内存框中看他存储了什么东西</li>
<li><img src="/Images/20251205213451.png"></li>
<li>两个值</li>
<li>然后进入406D80后，可以知道那里面就是对比长度和内容的。也可以得知这两个值相当于指针，从开始到结束</li>
<li>第一个是开始，第二个是结束，CTRL+g进行跳转</li>
<li><img src="/Images/20251205214825.png"></li>
<li><img src="/Images/20251205215713.png"></li>
<li>就找到了这段加密字符</li>
<li>ok，返回到之前那两个断点之前一大段的汇编那里</li>
<li>会发现401fcc是加密函数</li>
<li><img src="/Images/20251205221141.png"></li>
<li>这里给出官方的WP脚本</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">flag = [</span><br><span class="line">    <span class="number">0xFC</span>, <span class="number">0xEA</span>, <span class="number">0x15</span>, <span class="number">0x2C</span>, <span class="number">0x86</span>, <span class="number">0x38</span>, <span class="number">0x3F</span>, <span class="number">0xF3</span>, <span class="number">0x92</span>, <span class="number">0xCE</span>, <span class="number">0xDA</span>, <span class="number">0x8E</span>, <span class="number">0x48</span>, <span class="number">0xD3</span>, <span class="number">0x7</span>, <span class="number">0x9F</span>,</span><br><span class="line">    <span class="number">0xD9</span>, <span class="number">0x57</span>, <span class="number">0xB1</span>, <span class="number">0xEE</span>, <span class="number">0x41</span>, <span class="number">0x9A</span>, <span class="number">0x4D</span>, <span class="number">0xC5</span>, <span class="number">0x65</span>, <span class="number">0x6A</span>, <span class="number">0xFF</span>, <span class="number">0xC9</span>, <span class="number">0x5D</span>, <span class="number">0x34</span>, <span class="number">0xAD</span>, <span class="number">0xEA</span>,</span><br><span class="line">    <span class="number">0xB1</span>, <span class="number">0x20</span>, <span class="number">0x4B</span>, <span class="number">0xDC</span>, <span class="number">0xBD</span>, <span class="number">0xD2</span>, <span class="number">0x35</span>, <span class="number">0x2</span>, <span class="number">0x84</span>, <span class="number">0x35</span>, <span class="number">0x71</span>, <span class="number">0xEC</span>, <span class="number">0xE0</span>, <span class="number">0x48</span>, <span class="number">0x8E</span>, <span class="number">0xEA</span>,</span><br><span class="line">    <span class="number">0x7B</span>, <span class="number">0xAA</span>, <span class="number">0xCF</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">key = <span class="string">&quot;XaleidscopiX&quot;</span></span><br><span class="line">s = []</span><br><span class="line">t = []</span><br><span class="line"></span><br><span class="line"><span class="comment"># KSA Initialization</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">    s.append(i)</span><br><span class="line">    t.append(<span class="built_in">ord</span>(key[i % <span class="built_in">len</span>(key)]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># KSA Scrambling</span></span><br><span class="line">j = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">    j = (j + s[i] + t[i]) % <span class="number">256</span></span><br><span class="line">    s[i], s[j] = s[j], s[i]</span><br><span class="line"></span><br><span class="line">k = []</span><br><span class="line">i = <span class="number">0</span></span><br><span class="line">j = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># PRGA Keystream Generation</span></span><br><span class="line"><span class="keyword">for</span> r <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(flag)):</span><br><span class="line">    i = (i + <span class="number">1</span>) % <span class="number">256</span></span><br><span class="line">    j = (j + s[i]) % <span class="number">256</span></span><br><span class="line">    s[i], s[j] = s[j], s[i]</span><br><span class="line">    t_val = (s[i] + s[j]) % <span class="number">256</span>  <span class="comment"># 使用 t_val 避免与全局列表 t 混淆</span></span><br><span class="line">    k.append(s[t_val])</span><br><span class="line"></span><br><span class="line"><span class="comment"># Decryption (Final XOR operation)</span></span><br><span class="line"><span class="keyword">for</span> idx <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(flag)):</span><br><span class="line">    <span class="comment"># Decryption formula: (Ciphertext XOR Keystream XOR 7)</span></span><br><span class="line">    decrypted_byte = (flag[idx] ^ k[idx] ^ <span class="number">7</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(decrypted_byte), end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="Calamity-Fortune"><a href="#Calamity-Fortune" class="headerlink" title="Calamity_Fortune"></a>Calamity_Fortune</h1><ul>
<li>拖进ida分析一下</li>
<li><img src="/Images/202512181958.png"></li>
<li>同步分析在反汇编中的跳跃中打断点</li>
<li><img src="/Images/202512182000.png"></li>
<li>调试中，在寄存器窗口，按e将ZF改为1，来跳跃判断</li>
<li><img src="/Images/202512182001.png"></li>
<li>持续步进会发现别有洞天，MessageBoxA是个假函数，被调到了另一个函数中</li>
<li><img src="/Images/202512182005.png"></li>
<li>继续步入到正确的函数，f5看伪代码</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br></pre></td><td class="code"><pre><span class="line">__int64 <span class="title function_">sub_402B50</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> n79; <span class="comment">// dl</span></span><br><span class="line">  <span class="type">char</span> *Buffer_1; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">char</span> n87; <span class="comment">// dl</span></span><br><span class="line">  <span class="type">char</span> *i; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 *v5; <span class="comment">// r9</span></span><br><span class="line">  _BYTE *v6; <span class="comment">// rdx</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> n44; <span class="comment">// esi</span></span><br><span class="line">  <span class="type">char</span> n75; <span class="comment">// dl</span></span><br><span class="line">  <span class="type">char</span> *j; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> *v10; <span class="comment">// r10</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 *v11; <span class="comment">// rdx</span></span><br><span class="line">  <span class="type">int</span> n32; <span class="comment">// ecx</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v13; <span class="comment">// r8d</span></span><br><span class="line">  <span class="type">int</span> v14; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v15; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v16; <span class="comment">// r11d</span></span><br><span class="line">  <span class="type">int</span> n1634492739; <span class="comment">// ebp</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v18; <span class="comment">// r9d</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> *v19; <span class="comment">// r8</span></span><br><span class="line">  <span class="type">int</span> k; <span class="comment">// ecx</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v21; <span class="comment">// edx</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v22; <span class="comment">// ecx</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 *v23; <span class="comment">// r10</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> *v24; <span class="comment">// rdi</span></span><br><span class="line">  _DWORD *v25; <span class="comment">// r8</span></span><br><span class="line">  _DWORD *v26; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">int</span> m; <span class="comment">// ecx</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v28; <span class="comment">// edx</span></span><br><span class="line">  _BYTE *v29; <span class="comment">// r9</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v30; <span class="comment">// r8d</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 n; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">char</span> n61; <span class="comment">// dl</span></span><br><span class="line">  _BYTE *v33; <span class="comment">// rbx</span></span><br><span class="line">  <span class="type">int</span> v34; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">char</span> v35; <span class="comment">// r8</span></span><br><span class="line">  _BYTE *v36; <span class="comment">// rdx</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 *v37; <span class="comment">// rdx</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 *v38; <span class="comment">// rbx</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 *v39; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">char</span> *v40; <span class="comment">// rcx</span></span><br><span class="line">  <span class="type">int</span> ii; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">char</span> *Kbi_so_Buuhu&amp;_1; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">char</span> jj; <span class="comment">// dl</span></span><br><span class="line">  <span class="type">char</span> n65; <span class="comment">// dl</span></span><br><span class="line">  <span class="type">char</span> *kk; <span class="comment">// rax</span></span><br><span class="line">  _QWORD Calamity_Fortune[<span class="number">2</span>]; <span class="comment">// [rsp+20h] [rbp-218h] BYREF</span></span><br><span class="line">  <span class="type">char</span> Wkbftb_Niwrs__hru_akf_[<span class="number">22</span>]; <span class="comment">// [rsp+30h] [rbp-208h] BYREF</span></span><br><span class="line">  __int16 v49; <span class="comment">// [rsp+46h] [rbp-1F2h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v50; <span class="comment">// [rsp+50h] [rbp-1E8h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v51; <span class="comment">// [rsp+54h] [rbp-1E4h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v52; <span class="comment">// [rsp+78h] [rbp-1C0h]</span></span><br><span class="line">  _BYTE v53[<span class="number">44</span>]; <span class="comment">// [rsp+80h] [rbp-1B8h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v54; <span class="comment">// [rsp+ACh] [rbp-18Ch] BYREF</span></span><br><span class="line">  _BYTE v55[<span class="number">44</span>]; <span class="comment">// [rsp+B0h] [rbp-188h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v56; <span class="comment">// [rsp+DCh] [rbp-15Ch] BYREF</span></span><br><span class="line">  _QWORD v57[<span class="number">7</span>]; <span class="comment">// [rsp+E0h] [rbp-158h] BYREF</span></span><br><span class="line">  <span class="type">int</span> n925053188; <span class="comment">// [rsp+118h] [rbp-120h]</span></span><br><span class="line">  _BYTE v59[<span class="number">59</span>]; <span class="comment">// [rsp+120h] [rbp-118h] BYREF</span></span><br><span class="line">  _BYTE v60[<span class="number">5</span>]; <span class="comment">// [rsp+15Bh] [rbp-DDh] BYREF</span></span><br><span class="line">  <span class="type">char</span> Kbi_so_Buuhu&amp;[<span class="number">64</span>]; <span class="comment">// [rsp+160h] [rbp-D8h] BYREF</span></span><br><span class="line">  <span class="type">char</span> Buffer[<span class="number">85</span>]; <span class="comment">// [rsp+1A0h] [rbp-98h] BYREF</span></span><br><span class="line">  _BYTE Buffer_2[<span class="number">3</span>]; <span class="comment">// [rsp+1F5h] [rbp-43h] BYREF</span></span><br><span class="line"></span><br><span class="line">  n79 = <span class="number">79</span>;</span><br><span class="line">  v57[<span class="number">0</span>] = <span class="number">0x280D30732B077874L</span>L;</span><br><span class="line">  v57[<span class="number">1</span>] = <span class="number">0x242D00103573060BL</span>L;</span><br><span class="line">  v57[<span class="number">2</span>] = <span class="number">0x141C3406727D2F73L</span>L;</span><br><span class="line">  v57[<span class="number">3</span>] = <span class="number">0xA71137676362833L</span>L;</span><br><span class="line">  v57[<span class="number">4</span>] = <span class="number">0xE232B242F04742AL</span>L;</span><br><span class="line">  v57[<span class="number">5</span>] = <span class="number">0x2F373F03033D7310L</span>L;</span><br><span class="line">  v57[<span class="number">6</span>] = <span class="number">0x77067C3612772D7DL</span>L;</span><br><span class="line">  qmemcpy(Calamity_Fortune, <span class="string">&quot;Calamity_Fortune&quot;</span>, <span class="keyword">sizeof</span>(Calamity_Fortune));</span><br><span class="line">  qmemcpy(</span><br><span class="line">    Buffer,</span><br><span class="line">    <span class="string">&quot;Ofqni`&#x27;jfcb&#x27;ns&#x27;sont&#x27;afu+&#x27;sob&#x27;tretbvrbis&#x27;bidu~wsnhi&#x27;tohrkc&#x27;eb&#x27;f&#x27;wnbdb&#x27;ha&#x27;dflb&#x27;ahu&#x27;~hry&quot;</span>,</span><br><span class="line">    <span class="keyword">sizeof</span>(Buffer));</span><br><span class="line">  Buffer_1 = Buffer;</span><br><span class="line">  n925053188 = <span class="number">925053188</span>;</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    *Buffer_1++ = n79 ^ <span class="number">7</span>;</span><br><span class="line">    <span class="keyword">if</span> ( Buffer_2 == Buffer_1 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    n79 = *Buffer_1;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(Buffer);</span><br><span class="line">  n87 = <span class="number">87</span>;</span><br><span class="line">  qmemcpy(Wkbftb_Niwrs__hru_akf_, <span class="string">&quot;Wkbftb&#x27;Niwrs&#x27;~hru&#x27;akf`&quot;</span>, <span class="keyword">sizeof</span>(Wkbftb_Niwrs__hru_akf_));</span><br><span class="line">  <span class="keyword">for</span> ( i = Wkbftb_Niwrs__hru_akf_; ; n87 = *i )</span><br><span class="line">  &#123;</span><br><span class="line">    *i++ = n87 ^ <span class="number">7</span>;</span><br><span class="line">    <span class="keyword">if</span> ( i == (<span class="type">char</span> *)&amp;v49 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(Wkbftb_Niwrs__hru_akf_);</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%44s&quot;</span>, v55);</span><br><span class="line">  v4 = v55[<span class="number">0</span>];</span><br><span class="line">  v56 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( !v55[<span class="number">0</span>] )</span><br><span class="line">    <span class="keyword">goto</span> LABEL_11;</span><br><span class="line">  v5 = v55;</span><br><span class="line">  v6 = v55;</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">    n44 = <span class="number">1</span> - (<span class="type">unsigned</span> <span class="type">int</span>)v55 + (_DWORD)v6++;</span><br><span class="line">  <span class="keyword">while</span> ( *v6 );</span><br><span class="line">  <span class="keyword">if</span> ( n44 != <span class="number">44</span> )</span><br><span class="line">  &#123;</span><br><span class="line">LABEL_11:</span><br><span class="line">    n75 = <span class="number">75</span>;</span><br><span class="line">    qmemcpy(Kbi_so_Buuhu&amp;, <span class="string">&quot;Kbi`so&#x27;Buuhu&amp;&quot;</span>, <span class="number">13</span>);</span><br><span class="line">    <span class="keyword">for</span> ( j = Kbi_so_Buuhu&amp;; ; n75 = *j )</span><br><span class="line">    &#123;</span><br><span class="line">      *j++ = n75 ^ <span class="number">7</span>;</span><br><span class="line">      <span class="keyword">if</span> ( &amp;Kbi_so_Buuhu&amp;[<span class="number">13</span>] == j )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">puts</span>(Kbi_so_Buuhu&amp;);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  v10 = &amp;v50;</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v11 = v5;</span><br><span class="line">    n32 = <span class="number">0</span>;</span><br><span class="line">    v13 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v14 = v4 &lt;&lt; n32;</span><br><span class="line">      n32 += <span class="number">8</span>;</span><br><span class="line">      ++v11;</span><br><span class="line">      v13 |= v14;</span><br><span class="line">      <span class="keyword">if</span> ( n32 == <span class="number">32</span> )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      v4 = *v11;</span><br><span class="line">    &#125;</span><br><span class="line">    v5 += <span class="number">4</span>;</span><br><span class="line">    *v10++ = v13;</span><br><span class="line">    <span class="keyword">if</span> ( &amp;v56 == (<span class="type">char</span> *)v5 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    v4 = *v5;</span><br><span class="line">  &#125;</span><br><span class="line">  v15 = v52;</span><br><span class="line">  v16 = <span class="number">-1640531527</span>;</span><br><span class="line">  n1634492739 = <span class="number">1634492739</span>;</span><br><span class="line">  v18 = v50;</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v19 = &amp;v50;</span><br><span class="line">    <span class="keyword">for</span> ( k = <span class="number">0</span>; ; ++k )</span><br><span class="line">    &#123;</span><br><span class="line">      v21 = v19[<span class="number">1</span>];</span><br><span class="line">      ++v19;</span><br><span class="line">      v15 = v18</span><br><span class="line">          + (((v15 ^ *((_DWORD *)Calamity_Fortune + (((<span class="type">unsigned</span> __int8)(v16 &gt;&gt; <span class="number">2</span>) ^ (<span class="type">unsigned</span> __int8)k) &amp; <span class="number">3</span>)))</span><br><span class="line">            + (v21 ^ v16))</span><br><span class="line">           ^ (((<span class="number">4</span> * v21) ^ (v15 &gt;&gt; <span class="number">5</span>)) + ((<span class="number">16</span> * v15) ^ (v21 &gt;&gt; <span class="number">3</span>))));</span><br><span class="line">      *(v19 - <span class="number">1</span>) = v15;</span><br><span class="line">      <span class="keyword">if</span> ( k == <span class="number">9</span> )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      v18 = *v19;</span><br><span class="line">    &#125;</span><br><span class="line">    v18 = v50;</span><br><span class="line">    v22 = v16;</span><br><span class="line">    v16 -= <span class="number">1640531527</span>;</span><br><span class="line">    v15 = v52 + ((((v15 &gt;&gt; <span class="number">5</span>) ^ (<span class="number">4</span> * v50)) + ((<span class="number">16</span> * v15) ^ (v50 &gt;&gt; <span class="number">3</span>))) ^ ((v50 ^ v22) + (n1634492739 ^ v15)));</span><br><span class="line">    v52 = v15;</span><br><span class="line">    <span class="keyword">if</span> ( v16 == <span class="number">-865977613</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    n1634492739 = *((_DWORD *)Calamity_Fortune + (((<span class="type">unsigned</span> __int8)(v16 &gt;&gt; <span class="number">2</span>) ^ <span class="number">0xA</span>) &amp; <span class="number">3</span>));</span><br><span class="line">  &#125;</span><br><span class="line">  v23 = v53;</span><br><span class="line">  v24 = (<span class="type">unsigned</span> <span class="type">int</span> *)&amp;v51;</span><br><span class="line">  v25 = v53;</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v26 = v25;</span><br><span class="line">    <span class="keyword">for</span> ( m = <span class="number">0</span>; m != <span class="number">32</span>; m += <span class="number">8</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v26 = (_DWORD *)((<span class="type">char</span> *)v26 + <span class="number">1</span>);</span><br><span class="line">      v28 = v18 &gt;&gt; m;</span><br><span class="line">      *((_BYTE *)v26 - <span class="number">1</span>) = v28;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( &amp;v54 == ++v25 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    v18 = *v24++;</span><br><span class="line">  &#125;</span><br><span class="line">  qmemcpy(Kbi_so_Buuhu&amp;, <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span>, <span class="keyword">sizeof</span>(Kbi_so_Buuhu&amp;));</span><br><span class="line">  v29 = v59;</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    v30 = *v23 &lt;&lt; <span class="number">16</span>;</span><br><span class="line">    <span class="keyword">if</span> ( n44 != <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v30 |= v23[<span class="number">1</span>] &lt;&lt; <span class="number">8</span>;</span><br><span class="line">      <span class="keyword">if</span> ( n44 &gt; <span class="number">2</span> )</span><br><span class="line">        v30 |= v23[<span class="number">2</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> ( n = <span class="number">0</span>; n != <span class="number">4</span>; ++n )</span><br><span class="line">    &#123;</span><br><span class="line">      n61 = <span class="number">61</span>;</span><br><span class="line">      <span class="keyword">if</span> ( n &lt;= n44 )</span><br><span class="line">        n61 = Kbi_so_Buuhu&amp;[(v30 &gt;&gt; (<span class="number">-6</span> * n + <span class="number">18</span>)) &amp; <span class="number">0x3F</span>];</span><br><span class="line">      v29[n] = n61;</span><br><span class="line">    &#125;</span><br><span class="line">    v23 += <span class="number">3</span>;</span><br><span class="line">    v29 += <span class="number">4</span>;</span><br><span class="line">    n44 -= <span class="number">3</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( (<span class="type">unsigned</span> __int8 *)((<span class="type">char</span> *)&amp;v54 + <span class="number">1</span>) != v23 );</span><br><span class="line">  v33 = v60;</span><br><span class="line">  v60[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">  srand(<span class="number">0x65u</span>);</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v34 = rand();</span><br><span class="line">    v35 = *v33;</span><br><span class="line">    v36 = &amp;v59[v34 % (<span class="type">int</span>)(<span class="number">60</span> - (<span class="type">unsigned</span> <span class="type">int</span>)v60 + (_DWORD)v33)];</span><br><span class="line">    *v33 = *v36;</span><br><span class="line">    *v36 = v35;</span><br><span class="line">    v37 = v33 - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> ( v59 == v33 - <span class="number">1</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    --v33;</span><br><span class="line">  &#125;</span><br><span class="line">  v38 = v33 + <span class="number">59</span>;</span><br><span class="line">  v39 = v37;</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">    *v39++ ^= <span class="number">0x45u</span>;</span><br><span class="line">  <span class="keyword">while</span> ( v38 != v39 );</span><br><span class="line">  v40 = (<span class="type">char</span> *)v57 + <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span> ( ii = <span class="number">116</span>; ; ii = *v40++ )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( *v37 != ii )</span><br><span class="line">    &#123;</span><br><span class="line">      qmemcpy(Kbi_so_Buuhu&amp;, <span class="string">&quot;Dfkfjns~&amp;&#x27;wkbftb&#x27;su~&#x27;f`fni&quot;</span>, <span class="number">26</span>);</span><br><span class="line">      Kbi_so_Buuhu&amp;_1 = Kbi_so_Buuhu&amp;;</span><br><span class="line">      <span class="keyword">for</span> ( jj = <span class="number">68</span>; ; jj = *Kbi_so_Buuhu&amp;_1 )</span><br><span class="line">      &#123;</span><br><span class="line">        *Kbi_so_Buuhu&amp;_1++ = jj ^ <span class="number">7</span>;</span><br><span class="line">        <span class="keyword">if</span> ( &amp;Kbi_so_Buuhu&amp;[<span class="number">26</span>] == Kbi_so_Buuhu&amp;_1 )</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">puts</span>(Kbi_so_Buuhu&amp;);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v38 == ++v37 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  n65 = <span class="number">65</span>;</span><br><span class="line">  qmemcpy(Kbi_so_Buuhu&amp;, <span class="string">&quot;Ahusrib&amp;@hhc&#x27;Krdl&amp;&quot;</span>, <span class="number">18</span>);</span><br><span class="line">  <span class="keyword">for</span> ( kk = Kbi_so_Buuhu&amp;; ; n65 = *kk )</span><br><span class="line">  &#123;</span><br><span class="line">    *kk++ = n65 ^ <span class="number">7</span>;</span><br><span class="line">    <span class="keyword">if</span> ( &amp;Kbi_so_Buuhu&amp;[<span class="number">18</span>] == kk )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(Kbi_so_Buuhu&amp;);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>会发现主题流程为</li>
<li>读入 <code>input</code>（44 字节）</li>
<li><code>input</code> → 按 4 字节打包成 11 个 <code>uint32</code></li>
<li>对这 11 个 <code>uint32</code> 做一轮 <strong>XXTEA 变体加密</strong>（10 轮）</li>
<li>加密后的 44 字节 → <strong>Base64 编码</strong> → 60 字符</li>
<li>60 字符做一个固定 seed 的 <strong>伪随机洗牌</strong>（<code>srand(0x65)</code> + <code>rand()</code>）</li>
<li>洗牌后每个字节再 <strong>XOR 0x45</strong></li>
<li>把结果与程序里的 <strong>60 字节常量</strong>比较：相等则 success，否则 fail</li>
<li>脚本如下</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span>, <span class="type">Tuple</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -----------------------------------------------------------</span></span><br><span class="line"><span class="comment"># 辅助函数：模拟 C 语言的 32 位无符号整数溢出</span></span><br><span class="line"><span class="comment"># 因为 Python 的整数是无限精度的，而 C 语言中 uint32 超过 0xFFFFFFFF 会截断</span></span><br><span class="line"><span class="comment"># -----------------------------------------------------------</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">u32</span>(<span class="params">x: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    <span class="keyword">return</span> x &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># -----------------------------------------------------------</span></span><br><span class="line"><span class="comment"># 模拟 Windows C 运行时库 (MSVCRT) 的随机数生成器</span></span><br><span class="line"><span class="comment"># 题目通常是 Windows 下的 exe，其 rand() 实现是固定的线性同余生成器 (LCG)</span></span><br><span class="line"><span class="comment"># -----------------------------------------------------------</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MSVCRTRand</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, seed: <span class="built_in">int</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>.state = seed &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">rand</span>(<span class="params">self</span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">        <span class="comment"># 经典的 MSVCRT 参数：乘 214013，加 2531011</span></span><br><span class="line">        <span class="variable language_">self</span>.state = (<span class="variable language_">self</span>.state * <span class="number">214013</span> + <span class="number">2531011</span>) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        <span class="comment"># 返回高位部分 (15 bits)</span></span><br><span class="line">        <span class="keyword">return</span> (<span class="variable language_">self</span>.state &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0x7FFF</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># -----------------------------------------------------------</span></span><br><span class="line"><span class="comment"># 第一步：重建最终的密文数据</span></span><br><span class="line"><span class="comment"># 逆向时发现密文在内存中是以 QWORD (8字节) 数组形式存在的，需要拼起来</span></span><br><span class="line"><span class="comment"># -----------------------------------------------------------</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">build_expected_60</span>() -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">    <span class="comment"># 从 IDA Pro 等工具中提取的硬编码数据</span></span><br><span class="line">    v57_qwords = [</span><br><span class="line">        <span class="number">0x280D30732B077874</span>,</span><br><span class="line">        <span class="number">0x242D00103573060B</span>,</span><br><span class="line">        <span class="number">0x141C3406727D2F73</span>,</span><br><span class="line">        <span class="number">0x0A71137676362833</span>,</span><br><span class="line">        <span class="number">0x0E232B242F04742A</span>,</span><br><span class="line">        <span class="number">0x2F373F03033D7310</span>,</span><br><span class="line">        <span class="number">0x77067C3612772D7D</span>,</span><br><span class="line">    ]</span><br><span class="line">    n925 = <span class="number">925053188</span> <span class="comment"># 尾部的 4 字节数据</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># struct.pack(&quot;&lt;Q&quot;) 表示以小端序 (Little-Endian) 将整数打包成 bytes</span></span><br><span class="line">    v57_bytes = <span class="string">b&quot;&quot;</span>.join(struct.pack(<span class="string">&quot;&lt;Q&quot;</span>, q) <span class="keyword">for</span> q <span class="keyword">in</span> v57_qwords)  <span class="comment"># 共 7*8 = 56 字节</span></span><br><span class="line">    tail4 = struct.pack(<span class="string">&quot;&lt;I&quot;</span>, n925)  <span class="comment"># 4 字节</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 逻辑还原：</span></span><br><span class="line">    <span class="comment"># 原始比较逻辑可能是：先比较第0个字节是否为 0x74，然后比较后面的一串</span></span><br><span class="line">    <span class="comment"># 这里把它们拼接成完整的 60 字节目标密文</span></span><br><span class="line">    expected = <span class="built_in">bytes</span>([<span class="number">0x74</span>]) + (v57_bytes[<span class="number">1</span>:] + tail4)  <span class="comment"># 60 bytes</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(expected) == <span class="number">60</span></span><br><span class="line">    <span class="keyword">return</span> expected</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># -----------------------------------------------------------</span></span><br><span class="line"><span class="comment"># 第二步：逆向 Fisher–Yates 乱序算法</span></span><br><span class="line"><span class="comment"># 正向加密时：从后往前遍历，每次生成一个随机位置并交换</span></span><br><span class="line"><span class="comment"># 逆向解密时：必须重现完全一样的随机数序列，然后倒着交换回去</span></span><br><span class="line"><span class="comment"># -----------------------------------------------------------</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">unshuffle_msvcrt</span>(<span class="params">shuffled: <span class="built_in">bytes</span>, seed: <span class="built_in">int</span> = <span class="number">0x65</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">    <span class="comment"># 初始化随机数生成器，种子为 0x65 (十进制 101)</span></span><br><span class="line">    r = MSVCRTRand(seed)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 1. 先把正向加密时产生的所有 swap 操作记录下来</span></span><br><span class="line">    <span class="comment"># 注意：必须按正向的顺序调用 r.rand()，才能保证随机数序列一致</span></span><br><span class="line">    swaps: <span class="type">List</span>[<span class="type">Tuple</span>[<span class="built_in">int</span>, <span class="built_in">int</span>]] = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">59</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">        j = r.rand() % (i + <span class="number">1</span>)</span><br><span class="line">        swaps.append((i, j))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2. 开始执行逆向交换</span></span><br><span class="line">    a = <span class="built_in">bytearray</span>(shuffled)</span><br><span class="line">    <span class="comment"># reversed(swaps) -&gt; 后发生的交换先还原</span></span><br><span class="line">    <span class="keyword">for</span> i, j <span class="keyword">in</span> <span class="built_in">reversed</span>(swaps):</span><br><span class="line">        a[i], a[j] = a[j], a[i] <span class="comment"># 交换回原位</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(a)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># -----------------------------------------------------------</span></span><br><span class="line"><span class="comment"># 第三步：XXTEA 变种算法解密</span></span><br><span class="line"><span class="comment"># 这是一个典型的“魔改”TEA算法，通常涉及 DELTA 常量和复杂的移位异或</span></span><br><span class="line"><span class="comment"># -----------------------------------------------------------</span></span><br><span class="line">DELTA_SUB = <span class="number">1640531527</span>            <span class="comment"># 0x61C88647 (常见的 TEA 魔数 0x9E3779B9 的变体或计算结果)</span></span><br><span class="line">DELTA_ADD = <span class="number">0x9E3779B9</span>            </span><br><span class="line"></span><br><span class="line"><span class="comment"># 逆向工程得到的初始 SUM 和结束 SUM</span></span><br><span class="line">SUM_START = u32(-<span class="number">1640531527</span>)      <span class="comment"># 0x9E3779B9</span></span><br><span class="line">SUM_STOP  = u32(-<span class="number">865977613</span>)       <span class="comment"># 0xCC623AF3</span></span><br><span class="line">KEY2_FIRST = u32(<span class="number">1634492739</span>)      <span class="comment"># 初始的 Key2 变量值</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 核心混合函数1 (处理数组中间元素的)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mx_inner</span>(<span class="params">z: <span class="built_in">int</span>, y: <span class="built_in">int</span>, sum_: <span class="built_in">int</span>, k: <span class="built_in">int</span>, key4: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    对应加密代码中的：</span></span><br><span class="line"><span class="string">    e = ((sum &gt;&gt; 2) &amp; 3)</span></span><br><span class="line"><span class="string">    z = v[n-1], y = v[i+1]</span></span><br><span class="line"><span class="string">    mx = ((z&gt;&gt;5^y&lt;&lt;2) + (y&gt;&gt;3^z&lt;&lt;4)) ^ ((sum^y) + (key[(i&amp;3)^e]^z))</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 这里计算 key 的索引： ((sum&gt;&gt;2) ^ k) &amp; 3</span></span><br><span class="line">    idx = (((sum_ &gt;&gt; <span class="number">2</span>) &amp; <span class="number">0xFF</span>) ^ (k &amp; <span class="number">0xFF</span>)) &amp; <span class="number">3</span></span><br><span class="line">    <span class="keyword">return</span> u32(((z ^ key4[idx]) + (y ^ sum_)) ^ (((<span class="number">4</span> * y) ^ (z &gt;&gt; <span class="number">5</span>)) + ((<span class="number">16</span> * z) ^ (y &gt;&gt; <span class="number">3</span>))))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 核心混合函数2 (处理数组最后一个元素的)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mx_last</span>(<span class="params">z: <span class="built_in">int</span>, v0: <span class="built_in">int</span>, sum_old: <span class="built_in">int</span>, key2: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    对应加密循环中每一轮结尾对 v[n] 的特殊处理</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> u32((((z &gt;&gt; <span class="number">5</span>) ^ (<span class="number">4</span> * v0)) + ((<span class="number">16</span> * z) ^ (v0 &gt;&gt; <span class="number">3</span>))) ^ ((v0 ^ sum_old) + (key2 ^ z)))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">build_round_params</span>(<span class="params">key4: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="type">Tuple</span>[<span class="type">List</span>[<span class="built_in">int</span>], <span class="type">List</span>[<span class="built_in">int</span>]]:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    预计算每一轮的参数。</span></span><br><span class="line"><span class="string">    因为 XXTEA 是多轮加密（这里是 10 轮），解密时需要知道每一轮对应的 sum 值和 key2 值。</span></span><br><span class="line"><span class="string">    加密是从 sum = START 加到 STOP，解密我们先算出来存表里，方便倒着用。</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    sums: <span class="type">List</span>[<span class="built_in">int</span>] = []</span><br><span class="line">    key2s: <span class="type">List</span>[<span class="built_in">int</span>] = []</span><br><span class="line"></span><br><span class="line">    sum_ = SUM_START</span><br><span class="line">    key2 = KEY2_FIRST</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>): <span class="comment"># 循环 10 轮</span></span><br><span class="line">        sums.append(sum_)</span><br><span class="line">        key2s.append(key2)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 模拟加密时的更新逻辑</span></span><br><span class="line">        sum_ = u32(sum_ - DELTA_SUB) </span><br><span class="line">        <span class="keyword">if</span> sum_ == SUM_STOP:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="comment"># 计算下一轮用到的 key2</span></span><br><span class="line">        idx2 = (((sum_ &gt;&gt; <span class="number">2</span>) &amp; <span class="number">0xFF</span>) ^ <span class="number">0x0A</span>) &amp; <span class="number">3</span></span><br><span class="line">        key2 = key4[idx2]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> sums, key2s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt_variant</span>(<span class="params">words: <span class="type">List</span>[<span class="built_in">int</span>], key4: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="type">List</span>[<span class="built_in">int</span>]:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    解密主函数</span></span><br><span class="line"><span class="string">    words: 11 个 32位整数 (密文)</span></span><br><span class="line"><span class="string">    key4:  4 个 32位整数 (密钥)</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    v = [u32(x) <span class="keyword">for</span> x <span class="keyword">in</span> words]</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 获取每一轮的 sum 和 key2</span></span><br><span class="line">    sums, key2s = build_round_params(key4)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 倒着遍历每一轮 (Round 10 -&gt; Round 1)</span></span><br><span class="line">    <span class="keyword">for</span> sum_old, key2 <span class="keyword">in</span> <span class="built_in">zip</span>(<span class="built_in">reversed</span>(sums), <span class="built_in">reversed</span>(key2s)):</span><br><span class="line">        <span class="comment"># 1. 先逆向处理最后一个元素 v[10]</span></span><br><span class="line">        <span class="comment"># 加密时：v[10] += mx_last(...)</span></span><br><span class="line">        <span class="comment"># 解密时：v[10] -= mx_last(...)</span></span><br><span class="line">        z_new_v9 = v[<span class="number">9</span>]</span><br><span class="line">        v0_new = v[<span class="number">0</span>]</span><br><span class="line">        v[<span class="number">10</span>] = u32(v[<span class="number">10</span>] - mx_last(z_new_v9, v0_new, sum_old, key2))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 2. 逆向处理前面的元素 v[9] 到 v[0]</span></span><br><span class="line">        <span class="comment"># 加密时是从 0 到 9 顺序处理，解密时要从 9 到 0 倒序处理</span></span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">            y_old = v[k + <span class="number">1</span>]            <span class="comment"># 后一个元素 (已经是解密后的旧值了)</span></span><br><span class="line">            z = v[<span class="number">10</span>] <span class="keyword">if</span> k == <span class="number">0</span> <span class="keyword">else</span> v[k - <span class="number">1</span>]  <span class="comment"># 前一个元素</span></span><br><span class="line">            <span class="comment"># 执行减法操作逆向</span></span><br><span class="line">            v[k] = u32(v[k] - mx_inner(z, y_old, sum_old, k, key4))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> v</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># -----------------------------------------------------------</span></span><br><span class="line"><span class="comment"># 主程序入口</span></span><br><span class="line"><span class="comment"># -----------------------------------------------------------</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="comment"># 1. 获取目标字节串 (60 bytes)</span></span><br><span class="line">    expected = build_expected_60()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2. 逆向 XOR 操作</span></span><br><span class="line">    <span class="comment"># 加密逻辑推测：data[i] ^ 0x45</span></span><br><span class="line">    <span class="comment"># 解密逻辑：result[i] ^ 0x45 (异或的逆运算还是异或)</span></span><br><span class="line">    shuffled_b64 = <span class="built_in">bytes</span>(b ^ <span class="number">0x45</span> <span class="keyword">for</span> b <span class="keyword">in</span> expected)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3. 逆向 Shuffle 操作</span></span><br><span class="line">    <span class="comment"># 还原出 Base64 字符串</span></span><br><span class="line">    b64_text = unshuffle_msvcrt(shuffled_b64, seed=<span class="number">0x65</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[+] Base64 字符串: <span class="subst">&#123;b64_text&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 4. Base64 解码</span></span><br><span class="line">    <span class="comment"># 将 60 字节的 Base64 字符串解码为 44 字节的二进制数据</span></span><br><span class="line">    ct = base64.b64decode(b64_text, validate=<span class="literal">False</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(ct) != <span class="number">44</span>:</span><br><span class="line">        <span class="keyword">raise</span> SystemExit(<span class="string">f&quot;[!] base64 len=<span class="subst">&#123;<span class="built_in">len</span>(ct)&#125;</span> != 44&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[+] Ciphertext (Hex):&quot;</span>, ct.<span class="built_in">hex</span>())</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 5. 准备解密密钥和密文数组</span></span><br><span class="line">    <span class="comment"># 将 44 字节解包成 11 个整数 (11 * 4 = 44)</span></span><br><span class="line">    v = <span class="built_in">list</span>(struct.unpack(<span class="string">&quot;&lt;11I&quot;</span>, ct))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 密钥是 &quot;Calamity_Fortune&quot;，转成 4 个整数</span></span><br><span class="line">    key4 = <span class="built_in">list</span>(struct.unpack(<span class="string">&quot;&lt;4I&quot;</span>, <span class="string">b&quot;Calamity_Fortune&quot;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 6. 执行核心算法解密</span></span><br><span class="line">    pt_words = decrypt_variant(v, key4)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 7. 将解密后的整数数组打包回字符串</span></span><br><span class="line">    pt = struct.pack(<span class="string">&quot;&lt;11I&quot;</span>, *pt_words)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[+] 最终 Flag (Hex):&quot;</span>, pt.<span class="built_in">hex</span>())</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[+] 最终 Flag (UTF-8):&quot;</span>, pt.decode(<span class="string">&quot;utf-8&quot;</span>))</span><br><span class="line">    <span class="keyword">except</span> UnicodeDecodeError:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[!] 解码失败，可能包含非打印字符:&quot;</span>, pt)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
  </div>

  
  <div class="about" data-pagefind-ignore>
    <h2>关于本文</h2>
    <div class="details">
      <p>由 GuQing 撰写，采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc/4.0">CC BY-NC 4.0</a> 许可协议。</p>
    </div>
    
    <p class="tags">
      <i class="bi bi-tags icon"></i>
      
      <a href="/tags/Reverse-Writeup/" class="tag">#Reverse_Writeup</a>
      
    </p>
    
    
  </div>
  

  <div class="container post-prev-next" data-pagefind-ignore>
    <a class="next"></a>
    
    <a href="/2025/11/20/0xGame%202025%20Week2%20Reverse%20WP/" class="prev">
      <div class="text">
        <p class="label">上一篇</p>
        <h3 class="title">0xGame 2025 Week2 Reverse WP</h3>
      </div>
    </a>
    
  </div>

  
    
    
  
</article>


    </main>
    <footer>
  <div class="inner">
    <div class="links">
      
      <div class="group">
        <h2 class="title">Blog</h2>
        
        <a href="/" class="item">主页</a>
        
        <a href="/About-Me" class="item">关于我</a>
        
        <a href="/archives" class="item">归档</a>
        
        <a href="/tags" class="item">标签</a>
        
        <a href="/categories" class="item">分类</a>
        
        <a href="/search" class="item">搜索</a>
        
      </div>
      
      <div class="group">
        <h2 class="title">Related</h2>
        
        <a target="_blank" rel="noopener" href="https://hexo.io/" class="item">Hexo</a>
        
      </div>
      
    </div>
    <span>&copy; 2025 GuQing<br>由 <a href="http://hexo.io/" target="_blank">Hexo</a> 驱动</span>
    
    
      <br>
      <div class="color-scheme-toggle" role="radiogroup" id="theme-color-scheme-toggle">
        <label>
          <input type="radio" value="light">
          <span>浅色</span>
        </label>
        <label>
          <input type="radio" value="dark">
          <span>深色</span>
        </label>
        <label>
          <input type="radio" value="auto">
          <span>自动</span>
        </label>
      </div>
    
  </div>
</footer>


    
<script src="/js/main.js"></script>


    

    
    
<script src="/js/scroll-reveal.js"></script>

    

    

    

    
  </body>
</html>
